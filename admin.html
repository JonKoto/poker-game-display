<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Admin - Poker Game Display</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    min-height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    background: #1a1a2e;
    color: #e0e0e0;
    touch-action: manipulation;
  }

  .page {
    max-width: 700px;
    margin: 0 auto;
    padding: 16px;
    padding-top: calc(16px + env(safe-area-inset-top));
    padding-bottom: calc(16px + env(safe-area-inset-bottom));
  }

  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }
  .header h1 { font-size: 24px; font-weight: 700; color: #fff; }
  .back-link {
    color: #e94560;
    text-decoration: none;
    font-size: 15px;
    font-weight: 600;
    padding: 8px 14px;
    border: 1px solid #e94560;
    border-radius: 10px;
  }
  .back-link:active { background: #3a2040; }

  .section {
    background: #16213e;
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 16px;
  }
  .section-title {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #888;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .item-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }
  .item-label {
    flex: 1;
    font-size: 17px;
    font-weight: 500;
    color: #ccc;
    padding: 10px 0;
  }
  .delete-btn {
    width: 40px;
    height: 40px;
    background: #3a1a1a;
    border: none;
    border-radius: 10px;
    color: #e94560;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .delete-btn:active { background: #5a2a2a; }

  .add-row {
    display: flex;
    gap: 8px;
    margin-top: 4px;
  }
  .add-row input {
    flex: 1;
    min-height: 48px;
    padding: 10px 14px;
    background: #2a2a4a;
    border: 2px solid #444;
    border-radius: 12px;
    color: #e0e0e0;
    font-size: 16px;
    outline: none;
    font-family: inherit;
  }
  .add-row input:focus { border-color: #e94560; }
  .add-row button {
    min-width: 60px;
    min-height: 48px;
    background: #e94560;
    border: none;
    border-radius: 12px;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    padding: 0 14px;
  }
  .add-row button:active { background: #c73550; }

  .sound-card {
    background: #1a3a2e;
    border: 2px solid #2a5a4a;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 10px;
  }
  .sound-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .sound-card-label {
    font-size: 18px;
    font-weight: 600;
    color: #6fcf97;
  }
  .sound-card-delete {
    width: 36px;
    height: 36px;
    background: #3a1a1a;
    border: none;
    border-radius: 10px;
    color: #e94560;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .sound-card-delete:active { background: #5a2a2a; }

  .phrase-row {
    display: flex;
    gap: 6px;
    margin-bottom: 6px;
    align-items: center;
  }
  .phrase-text {
    flex: 1;
    font-size: 15px;
    color: #aaa;
    padding: 8px 12px;
    background: #16213e;
    border-radius: 8px;
  }
  .phrase-play {
    width: 38px;
    height: 38px;
    background: #16213e;
    border: 1px solid #2a5a4a;
    border-radius: 8px;
    color: #6fcf97;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .phrase-play:active { background: #2a5a4a; }

  .phrase-count {
    font-size: 13px;
    color: #555;
    margin-top: 4px;
  }

  .add-sound-btn {
    width: 100%;
    min-height: 48px;
    background: none;
    border: 2px dashed #2a5a4a;
    border-radius: 12px;
    color: #555;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 4px;
  }
  .add-sound-btn:active { background: #1a3a2e; }

  .notes-area {
    width: 100%;
    min-height: 100px;
    padding: 12px 14px;
    background: #2a2a4a;
    border: 2px solid #444;
    border-radius: 12px;
    color: #e0e0e0;
    font-size: 17px;
    font-family: inherit;
    resize: vertical;
    outline: none;
    margin-bottom: 10px;
  }
  .notes-area:focus { border-color: #e94560; }
  .notes-actions { display: flex; gap: 8px; }
  .notes-actions button {
    flex: 1;
    min-height: 48px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
  }
  .btn-primary { background: #e94560; color: #fff; }
  .btn-primary:active { background: #c73550; }
  .btn-secondary { background: #2a2a4a; color: #aaa; }
  .btn-secondary:active { background: #3a3a6a; }

  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    z-index: 100;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: #1e1e3a;
    border-radius: 16px;
    width: 100%;
    max-width: 600px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid #333;
  }
  .modal-header h2 { font-size: 20px; font-weight: 600; color: #fff; }
  .modal-close {
    background: none; border: none; color: #888;
    font-size: 28px; cursor: pointer; padding: 4px 8px; line-height: 1;
  }
  .modal-body {
    padding: 16px 20px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    max-height: 70vh;
  }
  .modal-body input {
    width: 100%;
    padding: 14px 16px;
    background: #2a2a4a;
    border: 2px solid #444;
    border-radius: 12px;
    color: #e0e0e0;
    font-size: 18px;
    font-family: inherit;
    outline: none;
    margin-bottom: 10px;
  }
  .modal-body input:focus { border-color: #e94560; }
  .modal-actions { display: flex; gap: 8px; margin-top: 4px; }
  .modal-actions button {
    flex: 1; min-height: 52px; border: none; border-radius: 12px;
    font-size: 18px; font-weight: 600; cursor: pointer;
  }

  .saved-flash {
    color: #6fcf97;
    font-size: 14px;
    font-weight: 600;
    opacity: 0;
    transition: opacity 0.3s;
    margin-left: 8px;
  }
  .saved-flash.show { opacity: 1; }
</style>
</head>
<body>

<div class="page">
  <div class="header">
    <h1>Admin</h1>
    <a href="index.html" class="back-link">Back to Display</a>
  </div>

  <div class="section">
    <div class="section-title">Games</div>
    <div id="game-list"></div>
    <div class="add-row">
      <input type="text" id="new-game-input" placeholder="Add new game...">
      <button onclick="addGame()">Add</button>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Soundboard</div>
    <div id="sound-list"></div>
    <button class="add-sound-btn" onclick="openAddSound()">+ Add Sound Button</button>
  </div>

  <div class="section">
    <div class="section-title">Notes <span class="saved-flash" id="notes-saved">Saved</span></div>
    <textarea class="notes-area" id="notes-area" placeholder="Enter notes for players..."></textarea>
    <div class="notes-actions">
      <button class="btn-secondary" onclick="clearNotes()">Clear</button>
      <button class="btn-primary" onclick="saveNotes()">Save Notes</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modal-title">Add Sound Button</h2>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<script src="storage.js"></script>
<script>
  showAuthGate();
  let games = loadData("games");
  let sounds = loadData("sounds");
  let state = loadData("state");

  // --- Games ---
  function renderGames() {
    const list = document.getElementById("game-list");
    list.innerHTML = "";
    games.forEach(g => {
      const row = document.createElement("div");
      row.className = "item-row";
      const label = document.createElement("div");
      label.className = "item-label";
      label.textContent = g;
      const del = document.createElement("button");
      del.className = "delete-btn";
      del.textContent = "\u00d7";
      del.onclick = () => removeGame(g);
      row.appendChild(label);
      row.appendChild(del);
      list.appendChild(row);
    });
  }

  function addGame() {
    const input = document.getElementById("new-game-input");
    const name = input.value.trim();
    if (!name) return;
    if (!games.includes(name)) {
      games.push(name);
      saveData("games", games);
    }
    input.value = "";
    renderGames();
  }

  function removeGame(name) {
    games = games.filter(g => g !== name);
    saveData("games", games);
    renderGames();
  }

  // --- Sounds ---
  function renderSounds() {
    const list = document.getElementById("sound-list");
    list.innerHTML = "";
    sounds.forEach((s, idx) => {
      const card = document.createElement("div");
      card.className = "sound-card";

      const header = document.createElement("div");
      header.className = "sound-card-header";
      const label = document.createElement("div");
      label.className = "sound-card-label";
      label.textContent = s.label;
      const del = document.createElement("button");
      del.className = "sound-card-delete";
      del.textContent = "\u00d7";
      del.onclick = () => removeSound(idx);
      header.appendChild(label);
      header.appendChild(del);
      card.appendChild(header);

      const phrases = s.phrases || [];
      phrases.forEach(p => {
        const row = document.createElement("div");
        row.className = "phrase-row";
        const text = document.createElement("div");
        text.className = "phrase-text";
        text.textContent = p;
        const play = document.createElement("button");
        play.className = "phrase-play";
        play.textContent = "\u25B6";
        play.onclick = () => speak(p);
        row.appendChild(text);
        row.appendChild(play);
        card.appendChild(row);
      });

      const count = document.createElement("div");
      count.className = "phrase-count";
      count.textContent = phrases.length + " phrase" + (phrases.length !== 1 ? "s" : "");
      card.appendChild(count);

      list.appendChild(card);
    });
  }

  function removeSound(idx) {
    sounds.splice(idx, 1);
    saveData("sounds", sounds);
    renderSounds();
  }

  // --- Notes ---
  function saveNotes() {
    state.notes = document.getElementById("notes-area").value;
    saveData("state", state);
    const flash = document.getElementById("notes-saved");
    flash.classList.add("show");
    setTimeout(() => flash.classList.remove("show"), 1500);
  }

  function clearNotes() {
    document.getElementById("notes-area").value = "";
  }

  // --- TTS ---
  function speak(text) {
    window.speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 0.95;
    window.speechSynthesis.speak(utter);
  }

  // --- Add Sound Modal ---
  function openAddSound() {
    const title = document.getElementById("modal-title");
    const body = document.getElementById("modal-body");
    title.textContent = "Add Sound Button";
    body.innerHTML = "";

    const labelInput = document.createElement("input");
    labelInput.type = "text";
    labelInput.placeholder = "Button label (e.g. Andy, you hit it)";
    body.appendChild(labelInput);

    const hint = document.createElement("div");
    hint.style.cssText = "font-size:13px;color:#888;margin:4px 0 8px;";
    hint.textContent = "Phrases (one will be chosen randomly):";
    body.appendChild(hint);

    const phraseList = document.createElement("div");
    phraseList.id = "phrase-inputs";
    body.appendChild(phraseList);

    function addPhraseRow(value) {
      const row = document.createElement("div");
      row.style.cssText = "display:flex;gap:6px;margin-bottom:8px;align-items:center;";
      const inp = document.createElement("input");
      inp.type = "text";
      inp.placeholder = "What it says...";
      inp.value = value || "";
      inp.style.marginBottom = "0";
      const testBtn = document.createElement("button");
      testBtn.textContent = "\u25B6";
      testBtn.title = "Test";
      testBtn.style.cssText = "width:44px;height:48px;background:#1a3a2e;border:2px solid #2a5a4a;border-radius:10px;color:#6fcf97;font-size:16px;cursor:pointer;flex-shrink:0;";
      testBtn.onclick = () => { if (inp.value) speak(inp.value); };
      const delBtn = document.createElement("button");
      delBtn.textContent = "\u00d7";
      delBtn.style.cssText = "width:44px;height:48px;background:#3a1a1a;border:none;border-radius:10px;color:#e94560;font-size:20px;cursor:pointer;flex-shrink:0;";
      delBtn.onclick = () => row.remove();
      row.appendChild(inp);
      row.appendChild(testBtn);
      row.appendChild(delBtn);
      phraseList.appendChild(row);
    }

    addPhraseRow("");

    const addPhraseBtn = document.createElement("button");
    addPhraseBtn.textContent = "+ Add phrase";
    addPhraseBtn.style.cssText = "background:none;border:1px dashed #444;border-radius:10px;color:#888;font-size:15px;padding:10px;width:100%;cursor:pointer;margin-bottom:12px;";
    addPhraseBtn.onclick = () => addPhraseRow("");
    body.appendChild(addPhraseBtn);

    const actions = document.createElement("div");
    actions.className = "modal-actions";
    const cancelBtn = document.createElement("button");
    cancelBtn.className = "btn-secondary";
    cancelBtn.textContent = "Cancel";
    cancelBtn.onclick = () => closeModal();
    const saveBtn = document.createElement("button");
    saveBtn.className = "btn-primary";
    saveBtn.textContent = "Save";
    saveBtn.onclick = () => {
      const label = labelInput.value.trim();
      const phrases = [...phraseList.querySelectorAll("input")]
        .map(i => i.value.trim())
        .filter(Boolean);
      if (label && phrases.length) {
        sounds.push({ label, phrases });
        saveData("sounds", sounds);
        renderSounds();
        closeModal();
      }
    };
    actions.appendChild(cancelBtn);
    actions.appendChild(saveBtn);
    body.appendChild(actions);

    document.getElementById("modal-overlay").classList.add("open");
    setTimeout(() => labelInput.focus(), 100);
  }

  function closeModal() {
    document.getElementById("modal-overlay").classList.remove("open");
  }

  document.getElementById("new-game-input").addEventListener("keydown", e => {
    if (e.key === "Enter") addGame();
  });

  // --- Init ---
  document.getElementById("notes-area").value = state.notes || "";
  renderGames();
  renderSounds();
</script>
</body>
</html>
